"use strict";window.digiriskdolibarr||(window.digiriskdolibarr={},window.digiriskdolibarr.scriptsLoaded=!1),window.digiriskdolibarr.scriptsLoaded||(window.digiriskdolibarr.init=function(){window.digiriskdolibarr.load_list_script()},window.digiriskdolibarr.load_list_script=function(){if(!window.digiriskdolibarr.scriptsLoaded){var i=void 0,e=void 0;for(i in window.digiriskdolibarr)for(e in window.digiriskdolibarr[i].init&&window.digiriskdolibarr[i].init(),window.digiriskdolibarr[i])window.digiriskdolibarr[i]&&window.digiriskdolibarr[i][e]&&window.digiriskdolibarr[i][e].init&&window.digiriskdolibarr[i][e].init();window.digiriskdolibarr.scriptsLoaded=!0}},window.digiriskdolibarr.refresh=function(){var i=void 0,e=void 0;for(i in window.digiriskdolibarr)for(e in window.digiriskdolibarr[i].refresh&&window.digiriskdolibarr[i].refresh(),window.digiriskdolibarr[i])window.digiriskdolibarr[i]&&window.digiriskdolibarr[i][e]&&window.digiriskdolibarr[i][e].refresh&&window.digiriskdolibarr[i][e].refresh()},$(document).ready(window.digiriskdolibarr.init)),window.digiriskdolibarr.accident={},window.digiriskdolibarr.accident.init=function(){window.digiriskdolibarr.accident.event()},window.digiriskdolibarr.accident.event=function(){$(document).on("submit",".sendfile",window.digiriskdolibarr.accident.tmpStockFile),$(document).on("click",".linked-file-delete-workstop",window.digiriskdolibarr.accident.removeFile),$(document).on("change","#external_accident",window.digiriskdolibarr.accident.showExternalAccidentLocation)},window.digiriskdolibarr.accident.tmpStockFile=function(e,i=""){var s=$("#sendfile").prop("files"),t=new FormData;for(let i=0;i<s.length;i++){var a=s[i];t.append("files[]",a)}var n=window.saturne.toolbox.getToken(),i=0<i.length?"&subaction="+i:"";$.ajax({url:document.URL+"&action=sendfile&objectlineid="+e+"&token="+n+i,type:"POST",processData:!1,contentType:!1,data:t,success:function(i){$("#sendFileForm"+e).html($(i).find("#fileLinkedTable"+e))},error:function(){}})},window.digiriskdolibarr.accident.removeFile=function(i){let e=$(this).attr("value");var s=$(this).hasClass("edit-line")?"&subaction=editline":"";e=e.replace("_mini","");let t=$(this).closest(".objectline").attr("value");var a=window.saturne.toolbox.getToken();$.ajax({url:document.URL+"&action=removefile&filetodelete="+e+"&objectlineid="+t+"&token="+a+s,type:"POST",processData:!1,contentType:!1,success:function(i){$("#sendFileForm"+t).html($(i).find("#fileLinkedTable"+t))},error:function(){}})},window.digiriskdolibarr.accident.showExternalAccidentLocation=function(){var i=$(this).closest(".accident-table").find(".fk_element_field"),e=$(this).closest(".accident-table").find(".fk_soc_field"),s=$(this).closest(".accident-table").find(".accident_location_field");switch($(this).closest(".accident-table").find("#select2-external_accident-container").attr("title")){case"Non":i.attr("style",""),e.attr("style","display:none"),s.attr("style","display:none"),i.removeClass("hidden"),e.addClass("hidden"),s.addClass("hidden");break;case"Oui":i.attr("style","display:none"),e.attr("style",""),s.attr("style","display:none"),i.addClass("hidden"),e.removeClass("hidden"),s.addClass("hidden");break;case"Autre":i.attr("style","display:none"),e.attr("style","display:none"),s.attr("style",""),i.addClass("hidden"),e.addClass("hidden"),s.removeClass("hidden")}},window.digiriskdolibarr.button={},window.digiriskdolibarr.button.init=function(){window.digiriskdolibarr.button.event()},window.digiriskdolibarr.button.event=function(){$(document).on("click",".wpeo-button:submit",window.digiriskdolibarr.button.addLoader),$(document).on("click",".auto-download",window.digiriskdolibarr.button.addLoader)},window.digiriskdolibarr.button.addLoader=function(){window.saturne.loader.display($(this)),$(this).toggleClass("button-blue button-disable")},window.digiriskdolibarr.dashboard={},window.digiriskdolibarr.dashboard.init=function(){window.digiriskdolibarr.dashboard.event()},window.digiriskdolibarr.dashboard.event=function(){$(document).on("change",".add-dashboard-widget",window.digiriskdolibarr.dashboard.addDashBoardInfo),$(document).on("click",".close-dashboard-widget",window.digiriskdolibarr.dashboard.closeDashBoardInfo)},window.digiriskdolibarr.dashboard.addDashBoardInfo=function(){var i=document.getElementById("dashBoardForm"),i=new FormData(i).get("boxcombo"),e=window.saturne.toolbox.getQuerySeparator(document.URL),s=window.saturne.toolbox.getToken();$.ajax({url:document.URL+e+"action=adddashboardinfo&token="+s,type:"POST",processData:!1,data:JSON.stringify({dashboardWidgetName:i}),contentType:!1,success:function(i){window.location.reload()},error:function(){}})},window.digiriskdolibarr.dashboard.closeDashBoardInfo=function(){let e=$(this);var i=e.attr("data-widgetname"),s=window.saturne.toolbox.getQuerySeparator(document.URL),t=window.saturne.toolbox.getToken();$.ajax({url:document.URL+s+"action=closedashboardinfo&token="+t,type:"POST",processData:!1,data:JSON.stringify({dashboardWidgetName:i}),contentType:!1,success:function(i){e.closest(".box-flex-item").fadeOut(400),$(".add-widget-box").attr("style",""),$(".add-widget-box").html($(i).find(".add-widget-box").children())},error:function(){}})},window.digiriskdolibarr.digiriskelement={},window.digiriskdolibarr.digiriskelement.init=function(){window.digiriskdolibarr.digiriskelement.event()},window.digiriskdolibarr.digiriskelement.event=function(){$(document).on("click","#select_all_shared_elements_by_digiriskelement",window.digiriskdolibarr.digiriskelement.selectAllSharedElementByDigiriskElement),$(document).on("click","#select_all_shared_elements",window.digiriskdolibarr.digiriskelement.selectAllSharedElements)},window.digiriskdolibarr.digiriskelement.selectAllSharedElementByDigiriskElement=function(i){var e=$(this).attr("name");this.checked?$(this).closest(".ui-widget").find(".importsharedelement-digiriskelement-"+e).not(":disabled").each(function(){this.checked=!0}):$(this).closest(".ui-widget").find(".importsharedelement-digiriskelement-"+e).not(":disabled").each(function(){this.checked=!1})},window.digiriskdolibarr.digiriskelement.selectAllSharedElements=function(i){this.checked?$(this).closest(".ui-widget").find(":checkbox").not(":disabled").not("#select_all_shared_elements_by_digiriskelement").each(function(){this.checked=!0}):$(this).closest(".ui-widget").find(":checkbox").not(":disabled").not("#select_all_shared_elements_by_digiriskelement").each(function(){this.checked=!1})},window.digiriskdolibarr.document={},window.digiriskdolibarr.document.canvas,window.digiriskdolibarr.document.buttonSignature,window.digiriskdolibarr.document.init=function(){window.digiriskdolibarr.document.event()},window.digiriskdolibarr.document.event=function(){$(document).on("click","#builddoc_generatebutton",window.digiriskdolibarr.document.displayLoader),$(document).on("click",".pdf-generation",window.digiriskdolibarr.document.displayLoader),$(document).on("click",".send-risk-assessment-document-by-mail",window.digiriskdolibarr.document.displayLoader)},window.digiriskdolibarr.document.displayLoader=function(){window.saturne.loader.display($(this).closest(".div-table-responsive-no-min"))},window.digiriskdolibarr.evaluationMethodEvarisk={},window.digiriskdolibarr.evaluationMethodEvarisk.init=function(){window.digiriskdolibarr.evaluationMethodEvarisk.event()},window.digiriskdolibarr.evaluationMethodEvarisk.event=function(){$(document).on("click",".wpeo-table.evaluation-method .table-cell.can-select",window.digiriskdolibarr.evaluationMethodEvarisk.selectSeuil)},window.digiriskdolibarr.evaluationMethodEvarisk.selectSeuil=function(i){$(this).closest(".table-row").find(".active").removeClass("active"),$(this).addClass("active");var s=$(this),t=s.closest(".modal-container"),s=s.data("evaluation-id");let a=[];if(Object.values(t.find(".table-cell.active.cell-"+s)).forEach(function(i){-1<$(i).data("seuil")&&a.push($(i).data("seuil"))}),5===a.length){let e=a[0]*a[1]*a[2]*a[3]*a[4];s=window.location.pathname.split(/view/)[0];fetch(s+"/js/json/default.json").then(i=>i.json()).then(i=>{i=i[0].option.matrix[e];t.find(".risk-evaluation-calculated-cotation").find(".risk-evaluation-cotation").attr("data-scale",window.digiriskdolibarr.evaluation.getDynamicScale(i)),t.find(".risk-evaluation-calculated-cotation").find(".risk-evaluation-cotation span").text(i),t.find(".risk-evaluation-content").find(".risk-evaluation-seuil").val(i),window.digiriskdolibarr.risk.haveDataInInput(t)})}},window.digiriskdolibarr.evaluator={},window.digiriskdolibarr.evaluator.init=function(){window.digiriskdolibarr.evaluator.event()},window.digiriskdolibarr.evaluator.event=function(){$(document).on("click",".evaluator-create",window.digiriskdolibarr.evaluator.createEvaluator),$(document).on("change","#fk_user_employer",window.digiriskdolibarr.evaluator.selectUser)},window.digiriskdolibarr.evaluator.selectUser=function(i){var e=window.saturne.toolbox.getToken(),s=$(this).closest(".modal-container"),t=s.find("#fk_user_employer").val();window.saturne.loader.display(s.find('input[name="evaluatorJob"]')),$.ajax({url:document.URL+"&action=getEvaluatorJob&token="+e,type:"POST",processData:!1,data:JSON.stringify({userID:t}),contentType:!1,success:function(i){s.find('input[name="evaluatorJob"]').val($(i).find('input[name="evaluatorJob"]').val()),s.find('input[name="evaluatorJob"]').removeClass("wpeo-loader")},error:function(i){}}),window.digiriskdolibarr.evaluator.haveDataInInput(s)},window.digiriskdolibarr.evaluator.haveDataInInput=function(i){i=i.parent().parent();i.hasClass("evaluator-add-modal")&&(0<i.find("#fk_user_employer").val()?i.find(".button-disable").removeClass("button-disable"):i.find(".evaluator-create").addClass("button-disable"))},window.digiriskdolibarr.evaluator.createEvaluator=function(i){var e=window.saturne.toolbox.getToken(),s=$(this).closest(".fichecenter").find(".evaluator-content"),t=$("#select2-fk_user_employer-container").attr("title"),t=$("#fk_user_employer").find("option:contains('"+t+"')").attr("value"),a=s.find("#EvaluatorDate").val(),n=s.find(".evaluator-duration .duration").val(),s=s.find(".evaluatorJob").val(),r=$(this).closest(".fichecenter").find(".div-table-responsive");window.saturne.loader.display(r),$.ajax({url:document.URL+"&action=add&token="+e,type:"POST",data:JSON.stringify({evaluatorID:t,date:a,duration:n,job:s}),processData:!1,contentType:!1,success:function(i){$(".fichecenter").html($(i).find("#searchFormList"));var e=$(".messageSuccessEvaluatorCreate");e.find($(i).find(".evaluator-create-success-notice")),e.removeClass("hidden")},error:function(i){var e=$(".messageErrorEvaluatorCreate");e.find($(i).find(".evaluator-create-error-notice")),e.removeClass("hidden")}})},window.digiriskdolibarr.form={},window.digiriskdolibarr.form.init=function(){window.digiriskdolibarr.form.event()},window.digiriskdolibarr.form.event=function(){$(document).on("submit","#searchFormListRisks, #searchFormInheritedListRisks, #searchFormSharedListRisks",window.digiriskdolibarr.form.searchForm)},window.digiriskdolibarr.form.searchForm=function(i){i.preventDefault();let e=$(this).closest("form").attr("id");var i=document.getElementById(e),i=new FormData(i),s=new FormData,t=["token","formfilteraction","action","id","sortfield","sortorder","page","contextpage","limit","toselect[]","massaction","confirm","cancel","pageplusone","backtopage"];for(const a of i.entries())(t.includes(a[0])||a[0].match(/search_/))&&s.append(a[0],a[1]);window.saturne.loader.display($("#"+e)),$.ajax({url:document.URL,type:"POST",data:s,processData:!1,contentType:!1,success:function(i){$(".wpeo-loader").removeClass("wpeo-loader"),$("#"+e).replaceWith($(i).find("#"+e))}})},window.digiriskdolibarr.navigation={},window.digiriskdolibarr.navigation.init=function(){window.digiriskdolibarr.navigation.event()},window.digiriskdolibarr.navigation.event=function(){$(document).on("click",".toggle-unit",window.digiriskdolibarr.navigation.switchToggle),$(document).on("click","#newGroupment",window.digiriskdolibarr.navigation.switchToggle),$(document).on("click","#newWorkunit",window.digiriskdolibarr.navigation.switchToggle),$(document).on("click",".digirisk-wrap .navigation-container .toolbar div",window.digiriskdolibarr.navigation.toggleAll),$(document).on("click","#slider",window.digiriskdolibarr.navigation.setUnitActive),$(document).on("click","#newGroupment",window.digiriskdolibarr.navigation.redirect),$(document).on("click","#newWorkunit",window.digiriskdolibarr.navigation.redirect),$(document).on("click",".side-nav-responsive",window.digiriskdolibarr.navigation.toggleMobileNav),$(document).on("click",".save-organization",window.digiriskdolibarr.navigation.saveOrganization)},window.digiriskdolibarr.navigation.switchToggle=function(i){i.preventDefault();var e,i=null==(i=localStorage.menu)||""==i?new Set:(i=JSON.parse(i),new Set(i));$(this).find(".toggle-icon").hasClass("fa-chevron-down")?($(this).find(".toggle-icon").removeClass("fa-chevron-down").addClass("fa-chevron-right"),e=$(this).closest(".unit").attr("id").split("unit")[1],$(this).closest(".unit").removeClass("toggled"),i.delete(e),localStorage.setItem("menu",JSON.stringify(Array.from(i.keys())))):$(this).find(".toggle-icon").hasClass("fa-chevron-right")&&($(this).find(".toggle-icon").removeClass("fa-chevron-right").addClass("fa-chevron-down"),$(this).closest(".unit").addClass("toggled"),e=$(this).closest(".unit").attr("id").split("unit")[1],i.add(e),localStorage.setItem("menu",JSON.stringify(Array.from(i.keys()))))},window.digiriskdolibarr.navigation.toggleAll=function(i){if(i.preventDefault(),$(this).hasClass("toggle-plus")){$(".digirisk-wrap .navigation-container .workunit-list .unit .toggle-icon").removeClass("fa-chevron-right").addClass("fa-chevron-down"),$(".digirisk-wrap .navigation-container .workunit-list .unit").addClass("toggled");let e=[];$(".digirisk-wrap .navigation-container .workunit-list .unit .title").get().map(function(i){e.push($(i).attr("value"))}),localStorage.setItem("menu",JSON.stringify(Array.from(e.values())))}$(this).hasClass("toggle-minus")&&($(".digirisk-wrap .navigation-container .workunit-list .unit.toggled").removeClass("toggled"),$(".digirisk-wrap .navigation-container .workunit-list .unit .toggle-icon").addClass("fa-chevron-right").removeClass("fa-chevron-down"),i=new Set("0"),localStorage.setItem("menu",JSON.stringify(Object.values(i))))},window.digiriskdolibarr.navigation.setUnitActive=function(i){$(".digirisk-wrap .navigation-container .unit.active").removeClass("active");var e=$(this).attr("value");$(this).closest(".unit").addClass("active"),$(this).closest(".unit").attr("value",e)},window.digiriskdolibarr.navigation.redirect=function(i){var e="",s=new window.URLSearchParams(window.location.search),s=$(s.get("id"));return history.pushState({path:document.URL},"",this.href),e=s?document.URL:document.URL.split("?id=")[0],$(this).closest(".side-nav").find("#id-left").removeClass("active"),$.ajax({url:e,success:function(i){$("#cardContent").html($(i).find("#cardContent"))}}),!1},window.digiriskdolibarr.navigation.toggleMobileNav=function(i){$(this).closest(".side-nav").find("#id-left").toggleClass("active")},window.digiriskdolibarr.navigation.saveOrganization=function(i){var e=window.saturne.toolbox.getToken();let s=[],t=[],a,n,r=$(".messageSuccessOrganizationSaved"),o=$(".messageErrorOrganizationSaved");$(".route").each(function(){a=$(this).attr("id"),n=$(this).parent("ul").attr("id").split(/space/)[1],s.push(a),t.push(n)}),window.saturne.loader.display($(this)),$.ajax({url:document.URL+"&action=saveOrganization&ids="+s.toString()+"&parent_ids="+t+"&token="+e,success:function(){r.removeClass("hidden"),$(".wpeo-loader").addClass("button-disable"),$(".wpeo-loader").attr("style","background: #47e58e !important;border-color: #47e58e !important;"),$(".wpeo-loader").find(".fas.fa-check").attr("style",""),$("a").attr("onclick","").unbind("click"),$(".wpeo-loader").removeClass("wpeo-loader")},error:function(){o.removeClass("hidden"),$(".wpeo-loader").addClass("button-disable"),$(".wpeo-loader").attr("style","background: #e05353 !important;border-color: #e05353 !important;"),$(".wpeo-loader").find(".fas.fa-times").attr("style",""),$(".wpeo-loader").removeClass("wpeo-loader")}})},window.digiriskdolibarr.preventionplan={},window.digiriskdolibarr.preventionplan.init=function(){window.digiriskdolibarr.preventionplan.event()},window.digiriskdolibarr.preventionplan.event=function(){$(document).on("click","#prior_visit_bool",window.digiriskdolibarr.preventionplan.showDateAndText)},window.digiriskdolibarr.preventionplan.showDateAndText=function(){var i=$(this).closest(".preventionplan-table").find(".prior_visit_date_field"),e=$(this).closest(".preventionplan-table").find(".prior_visit_text_field");i.hasClass("hidden")?(i.attr("style",""),e.attr("style",""),i.removeClass("hidden"),e.removeClass("hidden")):(i.attr("style","display:none"),e.attr("style","display:none"),i.addClass("hidden"),e.addClass("hidden"))},window.digiriskdolibarr.risk={},window.digiriskdolibarr.risk.init=function(){window.digiriskdolibarr.risk.event()},window.digiriskdolibarr.risk.event=function(){$(document).on("click",".category-danger .item, .wpeo-table .category-danger .item",window.digiriskdolibarr.risk.selectDanger),$(document).on("click",".risk-create:not(.button-disable)",window.digiriskdolibarr.risk.createRisk),$(document).on("click",".risk-save",window.digiriskdolibarr.risk.saveRisk),$(document).on("click",".risk-unlink-shared",window.digiriskdolibarr.risk.unlinkSharedRisk),$(document).on("click",'div[aria-describedby="dialog-confirm-actionButtonImportSharedRisks"] .ui-button.ui-corner-all.ui-widget',window.digiriskdolibarr.risk.sharedRiskBoxLoader)},window.digiriskdolibarr.risk.selectDanger=function(i){var e=$(this);e.closest(".content").removeClass("active"),e.closest(".wpeo-dropdown").find(".dropdown-toggle span").hide(),e.closest(".wpeo-dropdown").find(".dropdown-toggle img").show(),e.closest(".wpeo-dropdown").find(".dropdown-toggle img").attr("src",e.find("img").attr("src")),e.closest(".wpeo-dropdown").find(".dropdown-toggle img").attr("aria-label",e.closest(".wpeo-tooltip-event").attr("aria-label")),e.closest(".wpeo-dropdown").find(".input-hidden-danger").val(e.data("id"));1==e.closest(".wpeo-dropdown").find(".input-risk-description-prefill").val()&&e.closest(".risk-content").find(".risk-description textarea").text(e.closest(".wpeo-tooltip-event").attr("aria-label"));e=$(this).closest(".modal-container");window.digiriskdolibarr.risk.haveDataInInput(e)},window.digiriskdolibarr.risk.haveDataInInput=function(i){var i=i.parent().parent(),e=i.find(".risk-evaluation-seuil");i.hasClass("risk-add-modal")?0<=i.find('input[name="risk_category_id"]').val()&&0<=e.val()&&i.find(".risk-create.button-disable").removeClass("button-disable"):i.hasClass("risk-evaluation-add-modal")&&0<=e.val()&&i.find(".risk-evaluation-create.button-disable").removeClass("button-disable")},window.digiriskdolibarr.risk.sanitizeBeforeRequest=function(i){return"string"==typeof i&&i.match(/"/)?i.split(/"/).join(""):i},window.digiriskdolibarr.risk.createRisk=function(i){var e=window.saturne.toolbox.getToken(),s=$(this).closest(".fichecenter").find(".risk-content"),t=$(this).closest(".fichecenter").find(".risk-evaluation-container"),a=$(this).closest(".fichecenter").find(".riskassessment-task"),n=s.find(".risk-description textarea").val(),r=t.find(".risk-evaluation-comment textarea").val(),o=a.find("input").val(),n=window.digiriskdolibarr.risk.sanitizeBeforeRequest(n),r=window.digiriskdolibarr.risk.sanitizeBeforeRequest(r),o=window.digiriskdolibarr.risk.sanitizeBeforeRequest(o),s=s.find(".risk-category input").val(),d=t.find(".risk-evaluation-header .risk-evaluation-method").val(),l=t.find(".risk-evaluation-seuil").val(),c=t.find(".risk-evaluation-photo-single .filename").val(),t=t.find("#RiskAssessmentDate").val(),k=[],u=(Object.values($(".table-cell.active.cell-0")).forEach(function(i){-1<$(i).data("seuil")&&(k[$(i).data("type")]=$(i).data("seuil"))}),a.find("#RiskassessmentTaskDateStartModalRisk").val()),m=a.find("#RiskassessmentTaskDateStartModalRiskhour").val(),v=a.find("#RiskassessmentTaskDateStartModalRiskmin").val(),w=a.find("#RiskassessmentTaskDateEndModalRisk").val(),f=a.find("#RiskassessmentTaskDateEndModalRiskhour").val(),g=a.find("#RiskassessmentTaskDateEndModalRiskmin").val(),a=a.find(".riskassessment-task-budget").val();window.saturne.loader.display($(".fichecenter.risklist")),$.ajax({url:document.URL+"&action=add&token="+e,type:"POST",data:JSON.stringify({cotation:l,comment:r,category:s,description:n,method:d,photo:c,date:t,task:o,dateStart:u,hourStart:m,minStart:v,dateEnd:w,hourEnd:f,minEnd:g,budget:a,criteres:{gravite:k.gravite||0,occurrence:k.occurrence||0,protection:k.protection||0,formation:k.formation||0,exposition:k.exposition||0}}),processData:!1,contentType:!1,success:function(i){$(".fichecenter.risklist").html($(i).find("#searchFormListRisks"));var e=$(".messageSuccessRiskCreate");e.html($(i).find(".risk-create-success-notice")),e.removeClass("hidden"),$(".fichecenter.risklist").removeClass("wpeo-loader")},error:function(i){var e=$(".messageErrorRiskCreate");e.html($(i).find(".risk-create-error-notice")),e.removeClass("hidden"),$(".fichecenter.risklist").removeClass("wpeo-loader")}})},window.digiriskdolibarr.risk.saveRisk=function(i){var e=window.saturne.toolbox.getToken();let t=$(this).attr("value");var s=$(this).closest(".risk-container").find(".risk-content"),a=new window.URLSearchParams(window.location.search).get("id");let n=$(this).closest(".risk-container").find(".move-risk").hasClass("move-disabled");var r=s.find(".risk-description textarea").val(),r=window.digiriskdolibarr.risk.sanitizeBeforeRequest(r),s=s.find(".risk-category input").val(),o=(r=r||"",$(this).closest(".risk-container").find("#socid option:selected").val());o==a||n?(window.saturne.loader.display($(this).closest(".risk-row-content-"+t).find(".risk-description-"+t)),window.saturne.loader.display($(this).closest(".risk-row-content-"+t).find(".risk-category"))):window.saturne.loader.display($(this).closest(".risk-row-content-"+t));let d=$(".risk_row_"+t).find(".risk-container > div:nth-child(1)").text();$.ajax({url:document.URL+"&action=saveRisk&token="+e,type:"POST",processData:!1,data:JSON.stringify({riskID:t,category:s,comment:r,newParent:o}),contentType:!1,success:function(i){$(".wpeo-loader").removeClass("wpeo-loader");var e=$(".messageSuccessRiskEdit"),s=(o==a||n?($(".modal-active").removeClass("modal-active"),$(".risk-description-"+t).html($(i).find(".risk-description-"+t)),$(".risk-row-content-"+t).find(".risk-category .cell-risk").html($(i).find(".risk-row-content-"+t).find(".risk-category .cell-risk").children()),$(".risk-row-content-"+t).find(".risk-category").fadeOut(800),$(".risk-row-content-"+t).find(".risk-category").fadeIn(800),$(".risk-row-content-"+t).find(".risk-description-"+t).fadeOut(800),$(".risk-row-content-"+t).find(".risk-description-"+t).fadeIn(800)):$(".risk-row-content-"+t).fadeOut(800,function(){$(".fichecenter .opacitymedium.colorblack.paddingleft").html($(i).find("#searchFormListRisks .opacitymedium.colorblack.paddingleft"))}),""),s=(s=(s+=e.find(".valueForEditRisk1").val())+d)+e.find(".valueForEditRisk2").val();e.find("a").attr("href","#risk_row_"+t),e.find(".notice-subtitle .text").text(s),e.removeClass("hidden")},error:function(i){var e=$(".messageErrorRiskEdit"),s="",s=(s=(s+=e.find(".valueForEditRisk1").val())+d)+e.find(".valueForEditRisk2").val();e.find(".notice-subtitle .text").text(s),e.removeClass("hidden")}})},window.digiriskdolibarr.risk.unlinkSharedRisk=function(i){var e=window.saturne.toolbox.getToken();let s=$(this).attr("value"),t=(window.saturne.loader.display($(this)),$(".risk_row_"+s).find(".risk-container > div:nth-child(1)").text());var a=document.URL.split(/#/);$.ajax({url:a[0]+"&action=unlinkSharedRisk&token="+e,type:"POST",processData:!1,data:JSON.stringify({riskID:s}),contentType:!1,success:function(i){$(".confirmquestions").html($(i).find(".confirmquestions").children()),$(".fichecenter.sharedrisklist .opacitymedium.colorblack.paddingleft").html($(i).find("#searchFormSharedListRisks .opacitymedium.colorblack.paddingleft"));var i=$(".messageSuccessRiskUnlinkShared"),e=($("#risk_row_"+s).fadeOut(800),""),e=(e=(e+=i.find(".valueForUnlinkSharedRisk1").val())+t)+i.find(".valueForUnlinkSharedRisk2").val();i.find(".notice-subtitle .text").text(e),i.removeClass("hidden")},error:function(i){var e=$(".messageErrorRiskUnlinkShared"),s="",s=(s=(s+=e.find(".valueForUnlinkSharedRisk1").val())+t)+e.find(".valueForUnlinkSharedRisk2").val();e.find(".notice-subtitle .text").text(s),e.removeClass("hidden")}})},window.digiriskdolibarr.risk.sharedRiskBoxLoader=function(i){"Oui"==$(this).text()&&window.saturne.loader.display($("#searchFormSharedListRisks"))},window.digiriskdolibarr.evaluation={},window.digiriskdolibarr.evaluation.init=function(){window.digiriskdolibarr.evaluation.event()},window.digiriskdolibarr.evaluation.event=function(){$(document).on("click",".select-evaluation-method",window.digiriskdolibarr.evaluation.selectEvaluationMethod),$(document).on("click",".cotation-container .risk-evaluation-cotation.cotation",window.digiriskdolibarr.evaluation.selectSeuil),$(document).on("click",".risk-evaluation-create",window.digiriskdolibarr.evaluation.createEvaluation),$(document).on("click",".risk-evaluation-save",window.digiriskdolibarr.evaluation.saveEvaluation),$(document).on("click",".risk-evaluation-delete",window.digiriskdolibarr.evaluation.deleteEvaluation)},window.digiriskdolibarr.evaluation.selectEvaluationMethod=function(i){var e=$(this).closest(".modal-container");0<e.find(".risk-evaluation-multiple-method").val()&&(e.find(".select-evaluation-method.selected").removeClass("selected"),$(this).addClass("selected"),$(this).removeClass("button-grey"),$(this).addClass("button-blue"),e.find(".select-evaluation-method:not(.selected)").removeClass("button-blue"),e.find(".select-evaluation-method:not(.selected)").addClass("button-grey"),$(this).hasClass("evaluation-standard")?(e.find(".cotation-advanced").attr("style","display:none"),e.find(".cotation-standard").attr("style","display:block"),e.find(".risk-evaluation-calculated-cotation").attr("style","display:none"),e.find(".risk-evaluation-method").val("standard"),e.find(this).closest(".risk-evaluation-container").removeClass("advanced"),e.find(this).closest(".risk-evaluation-container").addClass("standard")):(e.find(".cotation-standard").attr("style","display:none"),e.find(".cotation-advanced").attr("style","display:block"),e.find(".risk-evaluation-calculated-cotation").attr("style","display:block"),e.find(".risk-evaluation-method").val("advanced"),e.find(this).closest(".risk-evaluation-container").addClass("advanced"),e.find(this).closest(".risk-evaluation-container").removeClass("standard")))},window.digiriskdolibarr.evaluation.selectSeuil=function(i){var e=$(this),s=$(this).closest(".modal-container"),t=e.data("seuil"),a=e.data("variable-id");e.closest(".cotation-container").find(".risk-evaluation-seuil").val($(this).text()),e.closest(".cotation-container").find(".selected-cotation").removeClass("selected-cotation"),e.addClass("selected-cotation"),a&&t&&window.digiriskdolibarr.risk.haveDataInInput(s)},window.digiriskdolibarr.evaluation.getDynamicScale=function(i){switch(!0){case 0===i:case i<48:return 1;case i<51:return 2;case i<79:return 3;case i<101:return 4}},window.digiriskdolibarr.evaluation.createEvaluation=function(i){var e=window.saturne.toolbox.getToken(),s=$(this).attr("value"),t=$(this).closest(".risk-evaluation-add-modal").find(".risk-evaluation-container"),a=t.find(".risk-evaluation-comment textarea").val(),a=window.digiriskdolibarr.risk.sanitizeBeforeRequest(a),n=t.find(".risk-evaluation-method").val(),r=t.find(".risk-evaluation-seuil").val(),o=t.find("#RiskAssessmentDateCreate0").val(),t=t.find(".risk-evaluation-photo-single .filename").val();let d=[];Object.values($(".table-cell.active.cell-0")).forEach(function(i){-1<$(i).data("seuil")&&(d[$(i).data("type")]=$(i).data("seuil"))}),window.saturne.loader.display($(this)),window.saturne.loader.display($(".risk-evaluation-list-container-"+s)),$.ajax({url:document.URL+"&action=addEvaluation&token="+e,type:"POST",data:JSON.stringify({cotation:r,comment:a,method:n,photo:t,date:o,riskId:s,criteres:{gravite:d.gravite||0,occurrence:d.occurrence||0,protection:d.protection||0,formation:d.formation||0,exposition:d.exposition||0}}),processData:!1,contentType:!1,success:function(i){0<$(i).find(".risk-evaluation-list-container-"+s).length?$(".risk-evaluation-list-container-"+s).replaceWith($(i).find(".risk-evaluation-list-container-"+s)):$(".div-table-responsive").replaceWith($(i).find(".div-table-responsive"));var e=$(".messageSuccessEvaluationCreate");$(".risk-evaluation-list-container-"+s).fadeOut(800),$(".risk-evaluation-list-container-"+s).fadeIn(800),e.empty(),e.html($(i).find(".riskassessment-create-success-notice")),e.find("a").attr("href","#risk_row_"+s),$(".wpeo-loader").removeClass("wpeo-loader"),e.removeClass("hidden")},error:function(i){var e=$(".messageErrorEvaluationCreate");$(this).closest(".risk-row-content-"+s).removeClass("wpeo-loader"),e.empty(),e.html($(i).find(".riskassessment-create-error-notice")),e.removeClass("hidden")}})},window.digiriskdolibarr.evaluation.deleteEvaluation=function(i){var e=window.saturne.toolbox.getToken(),s=$(this).closest(".risk-evaluation-in-modal"),t=s.find(".labelForDelete").val();let r=$(".messageSuccessEvaluationDelete"),o=$(".messageErrorEvaluationDelete"),d=s.attr("value");if(1!=confirm(t))return!1;{let t=$(this).closest(".risk-evaluations-list-content"),a=t.attr("value"),n=$(".risk-evaluation-ref-"+d).attr("value");window.saturne.loader.display($(".risk-evaluation-ref-"+d)),$.ajax({url:document.URL+"&action=deleteEvaluation&deletedEvaluationId="+d+"&token="+e,type:"POST",processData:!1,contentType:!1,success:function(i){$(".risk-evaluation-container-"+d).fadeOut(400),$(".risk-evaluation-list-content-"+a).replaceWith($(i).find(".risk-evaluation-list-content-"+a)),$("#risk_evaluation_add"+a).replaceWith($(i).find("#risk_evaluation_add"+a));var e=$("#risk_row_"+a).find(".table-cell-header-label").text(),s=e.split(/\(/)[1].split(/\)/)[0],e=($("#risk_row_"+a).find(".table-cell-header-label").html("<strong>"+e.split(/\(/)[0]+"("+(+s-1)+")</strong>"),s-1<1&&$(".fichecenter.risklist").html($(i).find("#searchFormListRisks")),t.removeClass("wpeo-loader"),""),e=(e=(e+=r.find(".valueForDeleteEvaluation1").val())+n)+r.find(".valueForDeleteEvaluation2").val();r.find(".notice-subtitle .text").text(e),r.removeClass("hidden")},error:function(i){var e="",e=(e=(e+=o.find(".valueForDeleteEvaluation1").val())+n)+o.find(".valueForDeleteEvaluation2").val();o.find(".notice-subtitle .text").text(e),o.removeClass("hidden")}})}},window.digiriskdolibarr.evaluation.saveEvaluation=function(i){var e=window.saturne.toolbox.getToken();let s=$(this).closest(".risk-evaluation-edit-modal"),t=s.attr("value");var a=s.find(".risk-evaluation-comment textarea").val();let n=$(this).closest(".risk-row").find(".risk-evaluations-list-content").attr("value"),r=$(".risk-evaluation-ref-"+t).attr("value"),o=$(".risk-evaluation-list-modal-"+n),d=$("#risk_evaluation_list"+n).hasClass("modal-active");var a=window.digiriskdolibarr.risk.sanitizeBeforeRequest(a),l=s.find(".risk-evaluation-method").val(),c=s.find(".risk-evaluation-seuil").val(),k=s.find("#RiskAssessmentDateEdit"+t).val(),u=s.find(".risk-evaluation-photo .filename").val();let m=[];Object.values($(".table-cell.active.cell-"+t)).forEach(function(i){-1<$(i).data("seuil")&&(m[$(i).data("type")]=$(i).data("seuil"))}),window.saturne.loader.display($(this)),$.ajax({url:document.URL+"&action=saveEvaluation&token="+e,type:"POST",processData:!1,data:JSON.stringify({cotation:c,comment:a,method:l,photo:u,date:k,evaluationID:t,criteres:{gravite:m.gravite||0,occurrence:m.occurrence||0,protection:m.protection||0,formation:m.formation||0,exposition:m.exposition||0}}),contentType:!1,success:function(i){$("#risk_evaluation_edit"+t).removeClass("modal-active"),0<$(i).find(".risk-evaluation-container.risk-evaluation-container-"+t+":not(.last-risk-assessment)").length?((d?($(".risk-evaluation-ref-"+t+":not(.last-risk-assessment)").fadeOut(800),$(".risk-evaluation-ref-"+t+":not(.last-risk-assessment)")):($(".risk-evaluation-container-"+t+":not(.last-risk-assessment)").fadeOut(800),$(".risk-evaluation-container-"+t+":not(.last-risk-assessment)"))).fadeIn(800),o.find(".risk-evaluation-ref-"+t).replaceWith($(i).find(".risk-evaluation-ref-"+t)),$(".risk-evaluation-container.risk-evaluation-container-"+t+":not(.last-risk-assessment)").replaceWith($(i).find(".risk-evaluation-container.risk-evaluation-container-"+t+":not(.last-risk-assessment)")),$("#risk_evaluation_add"+n).html($(i).find("#risk_evaluation_add"+n).children())):($(".div-table-responsive").html($(i).find(".div-table-responsive").children()),(d?($(".risk-evaluation-ref-"+t+":not(.last-risk-assessment)").fadeOut(800),$(".risk-evaluation-ref-"+t+":not(.last-risk-assessment)")):($(".risk-evaluation-container-"+t+":not(.last-risk-assessment)").fadeOut(800),$(".risk-evaluation-container-"+t+":not(.last-risk-assessment)"))).fadeIn(800)),$(".wpeo-loader").removeClass("wpeo-loader");var i=$(".messageSuccessEvaluationEdit"),e=(s.find("#risk_evaluation_edit"+t).removeClass("modal-active"),""),e=(e=(e+=i.find(".valueForEditEvaluation1").val())+r)+i.find(".valueForEditEvaluation2").val();i.find("a").attr("href","#risk_row_"+n),i.find(".notice-subtitle .text").text(e),i.removeClass("hidden")},error:function(){var i=$(".messageErrorEvaluationEdit"),e="",e=(e=(e+=i.find(".valueForEditEvaluation1").val())+r)+i.find(".valueForEditEvaluation2").val();i.find(".notice-subtitle .text").text(e),i.removeClass("hidden")}})},window.digiriskdolibarr.risksign={},window.digiriskdolibarr.risksign.init=function(){window.digiriskdolibarr.risksign.event()},window.digiriskdolibarr.risksign.event=function(){$(document).on("click",".risksign-category-danger .item, .wpeo-table .risksign-category-danger .item",window.digiriskdolibarr.risksign.selectRiskSign),$(document).on("click",".risksign-create:not(.button-disable)",window.digiriskdolibarr.risksign.createRiskSign),$(document).on("click",".risksign-save",window.digiriskdolibarr.risksign.saveRiskSign),$(document).on("click",".risksign-unlink-shared",window.digiriskdolibarr.risksign.unlinkSharedRiskSign)},window.digiriskdolibarr.risksign.selectRiskSign=function(i){var e=$(this),e=(e.closest(".content").removeClass("active"),e.closest(".wpeo-dropdown").find(".dropdown-toggle span").hide(),e.closest(".wpeo-dropdown").find(".dropdown-toggle img").show(),e.closest(".wpeo-dropdown").find(".dropdown-toggle img").attr("src",e.find("img").attr("src")),e.closest(".wpeo-dropdown").find(".dropdown-toggle img").attr("aria-label",e.closest(".wpeo-tooltip-event").attr("aria-label")),e.closest(".fichecenter").find(".input-hidden-danger").val(e.data("id")),$(this).closest(".modal-container"));window.digiriskdolibarr.risksign.haveDataInInput(e)},window.digiriskdolibarr.risksign.haveDataInInput=function(i){i=i.parent().parent();i.hasClass("risksign-add-modal")&&0<=i.find('input[name="risksign_category_id"]').val()&&i.find(".button-disable").removeClass("button-disable")},window.digiriskdolibarr.risksign.createRiskSign=function(i){var e=window.saturne.toolbox.getToken(),s=$(this).closest(".fichecenter").find(".risksign-content"),t=s.find(".risksign-category input").val(),s=s.find(".risksign-description textarea").val();window.saturne.loader.display($(".fichecenter.risksignlist")),$.ajax({url:document.URL+"&action=add&token="+e,type:"POST",data:JSON.stringify({riskSignCategory:t,riskSignDescription:s}),processData:!1,contentType:!1,success:function(i){$(".fichecenter.risksignlist").html($(i).find("#searchFormListRiskSigns"));var e=$(".messageSuccessRiskSignCreate");$(".fichecenter.risksignlist").removeClass("wpeo-loader"),e.html($(i).find(".risksign-create-success-notice")),e.removeClass("hidden")},error:function(i){var e=$(".messageErrorRiskCreate");e.html($(i).find(".risksign-create-error-notice")),e.removeClass("hidden")}})},window.digiriskdolibarr.risksign.saveRiskSign=function(i){var e=window.saturne.toolbox.getToken(),s=$(this).attr("value");let t=$(this).closest(".risksign-container").find(".risksign-content"),a="";var n=t.find(".risksign-category input").val(),r=t.find(".risksign-description textarea").val();let o=$(".risksign_row_"+s).find(".risksign-container > div:nth-child(1)").text();window.saturne.loader.display(t),$.ajax({url:document.URL+"&action=saveRiskSign&token="+e,data:JSON.stringify({riskSignID:s,riskSignCategory:n,riskSignDescription:r}),type:"POST",processData:!1,contentType:!1,success:function(i){$(".fichecenter.risksignlist").html($(i).find("#searchFormListRiskSigns"));i=$(".messageSuccessRiskSignEdit");t.removeClass("wpeo-loader"),a=(a=(a+=i.find(".valueForEditRiskSign1").val())+o)+i.find(".valueForEditRiskSign2").val(),i.find(".notice-subtitle .text").text(a),i.removeClass("hidden")},error:function(){var i=$(".messageErrorRiskSignEdit");t.removeClass("wpeo-loader"),a=(a=(a+=i.find(".valueForEditRiskSign1").val())+o)+i.find(".valueForEditRiskSign2").val(),i.find(".notice-subtitle .text").text(a),i.removeClass("hidden")}})},window.digiriskdolibarr.risksign.unlinkSharedRiskSign=function(i){var e=window.saturne.toolbox.getToken();let s=$(this).attr("value"),t=(window.saturne.loader.display($(this)),$(".risksign_row_"+s).find(".risksign-container > div:nth-child(1)").text());var a=document.URL.split(/#/);$.ajax({url:a[0]+"&action=unlinkSharedRiskSign&token="+e,type:"POST",processData:!1,data:JSON.stringify({risksignID:s}),contentType:!1,success:function(i){$(".fichecenter.sharedrisksignlist .opacitymedium.colorblack.paddingleft").html($(i).find("#searchFormSharedListRiskSigns .opacitymedium.colorblack.paddingleft"));var i=$(".messageSuccessRiskSignUnlinkShared"),e=($("#risksign_row_"+s).fadeOut(800),""),e=(e=(e+=i.find(".valueForUnlinkSharedRiskSign1").val())+t)+i.find(".valueForUnlinkSharedRiskSign2").val();i.find(".notice-subtitle .text").text(e),i.removeClass("hidden")},error:function(i){var e=$(".messageErrorRiskSignUnlinkShared"),s="",s=(s=(s+=e.find(".valueForUnlinkSharedRiskSign1").val())+t)+e.find(".valueForUnlinkSharedRiskSign2").val();e.find(".notice-subtitle .text").text(s),e.removeClass("hidden")}})},window.digiriskdolibarr.riskassessmenttask={},window.digiriskdolibarr.riskassessmenttask.init=function(){window.digiriskdolibarr.riskassessmenttask.event()},window.digiriskdolibarr.riskassessmenttask.event=function(){$(document).on("input",".riskassessment-task-label",window.digiriskdolibarr.riskassessmenttask.fillRiskAssessmentTaskLabel),$(document).on("click",".riskassessment-task-create",window.digiriskdolibarr.riskassessmenttask.createRiskAssessmentTask),$(document).on("click",".riskassessment-task-save",window.digiriskdolibarr.riskassessmenttask.saveRiskAssessmentTask),$(document).on("click",".riskassessment-task-delete",window.digiriskdolibarr.riskassessmenttask.deleteRiskAssessmentTask),$(document).on("click",".riskassessment-task-timespent-create",window.digiriskdolibarr.riskassessmenttask.createRiskAssessmentTaskTimeSpent),$(document).on("click",".riskassessment-task-timespent-save",window.digiriskdolibarr.riskassessmenttask.saveRiskAssessmentTaskTimeSpent),$(document).on("click",".riskassessment-task-timespent-delete",window.digiriskdolibarr.riskassessmenttask.deleteRiskAssessmentTaskTimeSpent),$(document).on("click",".riskassessment-task-progress-checkbox:not(.riskassessment-task-progress-checkbox-readonly)",window.digiriskdolibarr.riskassessmenttask.checkTaskProgress),$(document).on("change","#RiskassessmentTaskTimespentDatehour",window.digiriskdolibarr.riskassessmenttask.selectRiskassessmentTaskTimespentDateHour),$(document).on("change","#RiskassessmentTaskTimespentDatemin",window.digiriskdolibarr.riskassessmenttask.selectRiskassessmentTaskTimespentDateMin),$(document).on("keyup",".riskassessment-task-label",window.digiriskdolibarr.riskassessmenttask.checkRiskassessmentTaskLabelLength),$(document).on("click",".listingHeaderTaskTooltip",window.digiriskdolibarr.riskassessmenttask.redirectOnSharedTaskConfig)},window.digiriskdolibarr.riskassessmenttask.fillRiskAssessmentTaskLabel=function(i){var e=$(this).closest(".modal-container");window.digiriskdolibarr.riskassessmenttask.haveDataInInput(e)},window.digiriskdolibarr.riskassessmenttask.haveDataInInput=function(i){i=i.parent().parent();i.hasClass("riskassessment-task-add-modal")&&i.find('input[name="label"]').val().length&&i.find(".button-disable").removeClass("button-disable")},window.digiriskdolibarr.riskassessmenttask.createRiskAssessmentTask=function(i){var e=window.saturne.toolbox.getToken(),t=$(this).attr("value"),s=$(this).closest(".riskassessment-task-add-modal").find(".riskassessment-task-container"),a=s.find(".riskassessment-task-label").val(),a=window.digiriskdolibarr.risk.sanitizeBeforeRequest(a),n=s.find("#RiskassessmentTaskDateStart"+t).val(),r=s.find("#RiskassessmentTaskDateStart"+t+"hour").val(),o=s.find("#RiskassessmentTaskDateStart"+t+"min").val(),d=s.find("#RiskassessmentTaskDateEnd"+t).val(),l=s.find("#RiskassessmentTaskDateEnd"+t+"hour").val(),c=s.find("#RiskassessmentTaskDateEnd"+t+"min").val(),s=s.find(".riskassessment-task-budget").val();window.saturne.loader.display($(this)),window.saturne.loader.display($(".riskassessment-tasks"+t)),$.ajax({url:document.URL+"&action=addRiskAssessmentTask&token="+e,type:"POST",data:JSON.stringify({tasktitle:a,dateStart:n,hourStart:r,minStart:o,dateEnd:d,hourEnd:l,minEnd:c,budget:s,riskToAssign:t}),processData:!1,contentType:!1,success:function(i){$(".tasks-list-container-"+t).replaceWith($(i).find(".tasks-list-container-"+t));var e=$(".messageSuccessTaskCreate");$(".riskassessment-tasks"+t).fadeOut(800),$(".riskassessment-tasks"+t).fadeIn(800),e.find("a").attr("href","#risk_row_"+t),e.html($(i).find(".task-create-success-notice")),e.removeClass("hidden")},error:function(i){$(".wpeo-loader").removeClass("wpeo-loader"),window.scrollTo(0,0);var i=JSON.parse(i.responseText),e=$(".messageErrorTaskCreate"),s=($("#risk_assessment_task_add"+t).removeClass("modal-active"),""),s=(s=(s+=e.find(".valueForCreateTask1").val())+e.find(".valueForCreateTask2").val())+" : "+i.message;e.find(".notice-subtitle .text").text(s),e.removeClass("hidden")}})},window.digiriskdolibarr.riskassessmenttask.deleteRiskAssessmentTask=function(i){var e=window.saturne.toolbox.getToken(),s=$(this).closest(".riskassessment-tasks");let t=$(this).closest(".riskassessment-tasks").attr("value"),a=$(this).attr("value");s=s.find(".labelForDelete").val();let n=$(".messageSuccessTaskDelete"),r=$(".messageErrorTaskDelete");if(1!=confirm(s))return!1;{let s=$(".riskassessment-task-container-"+a).attr("value");window.saturne.loader.display($(".riskassessment-task-container-"+a)),$.ajax({url:document.URL+"&action=deleteRiskAssessmentTask&deletedRiskAssessmentTaskId="+a+"&token="+e,type:"POST",processData:!1,contentType:!1,success:function(i){$(".riskassessment-task-container-"+a).closest(".riskassessment-task-listing-wrapper").html($(i).find(".tasks-list-container-"+t).find(".riskassessment-task-listing-wrapper")),$(".riskassessment-tasks"+t).fadeOut(800),$(".riskassessment-tasks"+t).fadeIn(800);i="",i=(i=(i+=n.find(".valueForDeleteTask1").val())+s)+n.find(".valueForDeleteTask2").val();n.find("a").attr("href","#risk_row_"+t),n.find(".notice-subtitle .text").text(i),n.removeClass("hidden")},error:function(i){$(".wpeo-loader").removeClass("wpeo-loader"),window.scrollTo(0,0);var i=JSON.parse(i.responseText),e="",e=(e=(e=(e+=r.find(".valueForDeleteTask1").val())+s)+r.find(".valueForDeleteTask2").val())+" : "+i.message;r.find(".notice-subtitle .text").text(e),r.removeClass("hidden")}})}},window.digiriskdolibarr.riskassessmenttask.saveRiskAssessmentTask=function(i){var e=window.saturne.toolbox.getToken();let s=$(this).attr("value");var t=$(this).closest(".modal-container");let a=$(this).closest(".riskassessment-tasks").attr("value"),n="";var r=t.find(".riskassessment-task-label"+s).val(),r=window.digiriskdolibarr.risk.sanitizeBeforeRequest(r);let o=$(".riskassessment-task-single-"+s+" .riskassessment-task-reference").attr("value"),d=0;t.find(".riskassessment-task-progress-checkbox"+s).is(":checked")&&(d=1);var l=t.find("#RiskassessmentTaskDateStart"+s).val(),c=t.find("#RiskassessmentTaskDateStart"+s+"hour").val(),k=t.find("#RiskassessmentTaskDateStart"+s+"min").val(),u=t.find("#RiskassessmentTaskDateEnd"+s).val(),m=t.find("#RiskassessmentTaskDateEnd"+s+"hour").val(),v=t.find("#RiskassessmentTaskDateEnd"+s+"min").val(),t=t.find(".riskassessment-task-budget"+s).val();window.saturne.loader.display($(this)),window.saturne.loader.display($(".riskassessment-task-single-"+s)),$.ajax({url:document.URL+"&action=saveRiskAssessmentTask&token="+e,data:JSON.stringify({riskAssessmentTaskID:s,tasktitle:r,dateStart:l,hourStart:c,minStart:k,dateEnd:u,hourEnd:m,minEnd:v,budget:t,taskProgress:d}),type:"POST",processData:!1,contentType:!1,success:function(i){$("#risk_assessment_task_edit"+s).removeClass("modal-active"),$(".riskassessment-task-container-"+s).replaceWith($(i).find(".riskassessment-task-container-"+s).first());i=$(".messageSuccessTaskEdit");$(".riskassessment-tasks"+a).fadeOut(800),$(".riskassessment-tasks"+a).fadeIn(800),n=(n=(n+=i.find(".valueForEditTask1").val())+o)+i.find(".valueForEditTask2").val(),$(".wpeo-loader").removeClass("wpeo-loader"),$(".loader-spin").remove(),i.find("a").attr("href","#risk_row_"+a),i.find(".notice-subtitle .text").text(n),i.removeClass("hidden")},error:function(i){$(".wpeo-loader").removeClass("wpeo-loader"),window.scrollTo(0,0);var i=JSON.parse(i.responseText),e=$(".messageErrorTaskEdit");$("#risk_assessment_task_edit"+s).removeClass("modal-active"),$(".wpeo-loader").removeClass("wpeo-loader"),n=(n=(n=(n+=e.find(".valueForEditTask1").val())+o)+e.find(".valueForEditTask2").val()+" : ")+i.message,e.find(".notice-subtitle .text").text(n),e.removeClass("hidden")}})},window.digiriskdolibarr.riskassessmenttask.createRiskAssessmentTaskTimeSpent=function(i){var e=window.saturne.toolbox.getToken();let s=$(this).attr("value");var t=$(this).closest(".riskassessment-task-edit-modal"),a=t.find(".riskassessment-task-timespent-container");let n=t.find("riskassessment-task-single").attr("value"),r="",o=t.find(".riskassessment-task-reference").attr("value"),d=$(".id-container").find(".riskassessment-total-task-timespent-"+s);var t=a.find("#RiskassessmentTaskTimespentDate"+s).val(),l=a.find("#RiskassessmentTaskTimespentDate"+s+"hour").val(),c=a.find("#RiskassessmentTaskTimespentDate"+s+"min").val(),k=a.find(".riskassessment-task-timespent-comment").val(),k=window.digiriskdolibarr.risk.sanitizeBeforeRequest(k),a=a.find(".riskassessment-task-timespent-duration").val();window.saturne.loader.display($(this)),window.saturne.loader.display($(".riskassessment-task-single-"+s)),$.ajax({url:document.URL+"&action=addRiskAssessmentTaskTimeSpent&token="+e,type:"POST",data:JSON.stringify({taskID:s,date:t,hour:l,min:c,comment:k,duration:a}),processData:!1,contentType:!1,success:function(i){var e=$(".messageSuccessTaskTimeSpentCreate"+s);$(".riskassessment-tasks"+n).fadeOut(800),$(".riskassessment-tasks"+n).fadeIn(800),r=(r=(r+=e.find(".valueForCreateTaskTimeSpent1").val())+o)+e.find(".valueForCreateTaskTimeSpent2").val(),$(".riskassessment-task-timespent-container").find(".riskassessment-task-timespent-list-"+s).html($(i).find(".riskassessment-task-timespent-container").find(".riskassessment-task-timespent-list-"+s)),$(".riskassessment-task-container-"+s).closest(".riskassessment-tasks").html($(i).find(".riskassessment-task-container-"+s).closest(".riskassessment-tasks")),$(".loader-spin").remove(),$(".wpeo-loader").removeClass("wpeo-loader"),e.find(".notice-subtitle .text").text(r),e.removeClass("hidden"),d.html($(i).find(".modal-content").find(".riskassessment-total-task-timespent-"+s).first())},error:function(i){$(this).closest(".risk-row-content-"+n).removeClass("wpeo-loader");var e=$(".messageErrorTaskTimeSpentCreate"+s);e.html($(i).find(".task-timespent-create-error-notice")),e.removeClass("hidden")},complete:function(){$("#risk_assessment_task_edit"+s+".wpeo-modal").addClass("modal-active")}})},window.digiriskdolibarr.riskassessmenttask.deleteRiskAssessmentTaskTimeSpent=function(i){var e=window.saturne.toolbox.getToken();let a=$(this).closest(".riskassessment-task-timespent-list").attr("value"),n=$(this).attr("value");var s=$(this).attr("value"),t=$(this).closest(".riskassessment-task-timespent-"+n).find(".labelForDelete").val();let r=$(".id-container").first().find(".riskassessment-total-task-timespent-"+a);if(1!=confirm(t))return!1;{let t=$(".riskassessment-task-container-"+a).attr("value");window.saturne.loader.display($(this)),$.ajax({url:document.URL+"&action=deleteRiskAssessmentTaskTimeSpent&deletedRiskAssessmentTaskTimeSpentId="+s+"&token="+e,type:"POST",processData:!1,contentType:!1,success:function(i){var e=$(".messageSuccessTaskTimeSpentDelete"+a),s=($(".riskassessment-task-timespent-"+n).fadeOut(800),""),s=(s=(s+=e.find(".valueForDeleteTaskTimeSpent1").val())+t)+e.find(".valueForDeleteTaskTimeSpent2").val();e.find(".notice-subtitle .text").text(s),e.removeClass("hidden"),r.html($(i).find(".modal-content").find(".riskassessment-total-task-timespent-"+a).first())},error:function(i){var e=$(".messageErrorTaskDeleteTimeSpent"+a),s="",s=(s=(s+=e.find(".valueForDeleteTaskTimeSpent1").val())+t)+e.find(".valueForDeleteTaskTimeSpent2").val();e.find(".notice-subtitle .text").text(s),e.removeClass("hidden")}})}},window.digiriskdolibarr.riskassessmenttask.saveRiskAssessmentTaskTimeSpent=function(i){var e=window.saturne.toolbox.getToken();let s=$(this);var t=$(this).attr("value"),a=$(this).closest(".riskassessment-task-timespent-edit-modal").find(".riskassessment-task-timespent-container");let n=a.attr("value"),r="",o=$(".riskassessment-task-container-"+n).attr("value"),d=$(".id-container").first().find(".riskassessment-total-task-timespent-"+n);var l=a.find("#RiskassessmentTaskTimespentDateEdit"+t).val(),c=a.find("#RiskassessmentTaskTimespentDateEdit"+t+"hour").val(),k=a.find("#RiskassessmentTaskTimespentDateEdit"+t+"min").val(),u=a.find(".riskassessment-task-timespent-comment").val(),u=window.digiriskdolibarr.risk.sanitizeBeforeRequest(u),a=a.find(".riskassessment-task-timespent-duration").val();window.saturne.loader.display($(this)),window.saturne.loader.display($(".riskassessment-task-single-"+n)),$.ajax({url:document.URL+"&action=saveRiskAssessmentTaskTimeSpent&token="+e,data:JSON.stringify({riskAssessmentTaskTimeSpentID:t,taskID:n,date:l,hour:c,min:k,comment:u,duration:a}),type:"POST",processData:!1,contentType:!1,success:function(i){s.closest(".modal-active").removeClass("modal-active");var e=$(".messageSuccessTaskTimeSpentEdit"+n);$(".wpeo-loader").removeClass("wpeo-loader"),r=(r=(r+=e.find(".valueForEditTaskTimeSpent1").val())+o)+e.find(".valueForEditTaskTimeSpent2").val(),d.html($(i).find(".modal-content").find(".riskassessment-total-task-timespent-"+n).first()),$(".riskassessment-task-timespent-list-"+n).html($(i).find(".riskassessment-task-timespent-list-"+n).children()),e.find(".notice-subtitle .text").text(r),e.removeClass("hidden")},error:function(i){var e=$(".messageSuccessTaskTimeSpentEdit"+n);r=(r=(r+=e.find(".valueForEditTaskTimeSpent1").val())+o)+e.find(".valueForEditTaskTimeSpent2").val(),e.find(".notice-subtitle .text").text(r),e.removeClass("hidden")}})},window.digiriskdolibarr.riskassessmenttask.checkTaskProgress=function(i){var e=window.saturne.toolbox.getToken(),s=$(this).closest(".riskassessment-task-container"),t=s.find(".riskassessment-task-single-content").attr("value");let a=$(this).closest(".riskassessment-tasks").attr("value"),n="",r=s.attr("value"),o="";s.find(".riskassessment-task-progress-checkbox"+t).hasClass("progress-checkbox-check")?(o=0,s.find(".riskassessment-task-progress-checkbox"+t).toggleClass("progress-checkbox-check").toggleClass("progress-checkbox-uncheck")):s.find(".riskassessment-task-progress-checkbox"+t).hasClass("progress-checkbox-uncheck")&&(o=1,s.find(".riskassessment-task-progress-checkbox"+t).toggleClass("progress-checkbox-uncheck").toggleClass("progress-checkbox-check")),window.saturne.loader.display($(".riskassessment-task-single-"+t));s=window.location.href.replace(/#.*/,"");$.ajax({url:s+"&action=checkTaskProgress&token="+e,data:JSON.stringify({riskAssessmentTaskID:t,taskProgress:o}),type:"POST",processData:!1,contentType:!1,success:function(i){$(".fichecenter.risklist").html($(i).find("#searchFormListRisks"));i=$(".messageSuccessTaskEdit");$(".riskassessment-tasks"+a).fadeOut(800),$(".riskassessment-tasks"+a).fadeIn(800),n=(n=(n+=i.find(".valueForEditTask1").val())+r)+i.find(".valueForEditTask2").val(),i.find(".notice-subtitle .text").text(n),i.removeClass("hidden")},error:function(i){var e=$(".messageErrorTaskEdit");n=(n=(n+=e.find(".valueForEditTask1").val())+r)+e.find(".valueForEditTask2").val(),e.find(".notice-subtitle .text").text(n),e.removeClass("hidden")}})},window.digiriskdolibarr.riskassessmenttask.selectRiskassessmentTaskTimespentDateHour=function(i){$(this).closest(".nowraponall").find(".select-riskassessmenttask-timespent-datehour").remove(),$(this).before('<input class="select-riskassessmenttask-timespent-datehour" type="hidden" id="RiskassessmentTaskTimespentDatehour" name="RiskassessmentTaskTimespentDatehour" value='+$(this).val()+">")},window.digiriskdolibarr.riskassessmenttask.selectRiskassessmentTaskTimespentDateMin=function(i){$(this).closest(".nowraponall").find(".select-riskassessmenttask-timespent-datemin").remove(),$(this).before('<input class="select-riskassessmenttask-timespent-datemin" type="hidden" id="RiskassessmentTaskTimespentDatemin" name="RiskassessmentTaskTimespentDatemin" value='+$(this).val()+">")},window.digiriskdolibarr.riskassessmenttask.checkRiskassessmentTaskLabelLength=function(i){255<$(this).val().length?($(".messageWarningTaskLabel").removeClass("hidden"),$(".riskassessment-task-create").removeClass("button-blue"),$(".riskassessment-task-create").addClass("button-grey"),$(".riskassessment-task-create").addClass("button-disable")):($(".messageWarningTaskLabel").addClass("hidden"),$(".riskassessment-task-create").addClass("button-blue"),$(".riskassessment-task-create").removeClass("button-grey"),$(".riskassessment-task-create").removeClass("button-disable"))},window.digiriskdolibarr.riskassessmenttask.redirectOnSharedTaskConfig=function(i){var e=$(".riskassessment-tasks").find('input[name="sharedTaskTooltipUrl"]').val();window.open(location.origin+e,"_blank")},window.digiriskdolibarr.ticket={},window.digiriskdolibarr.ticket.init=function(){window.digiriskdolibarr.ticket.event()},window.digiriskdolibarr.ticket.event=function(){$(document).on("click",".ticket-parentCategory",window.digiriskdolibarr.ticket.selectParentCategory),$(document).on("click",".ticket-subCategory",window.digiriskdolibarr.ticket.selectSubCategory),$(document).on("submit","#sendFile",window.digiriskdolibarr.ticket.tmpStockFile),$(document).on("click",".linked-file-delete",window.digiriskdolibarr.ticket.removeFile),$(document).on("change",".add-dashboard-info",window.digiriskdolibarr.ticket.addDashBoardTicketInfo),$(document).on("click",".close-dashboard-info",window.digiriskdolibarr.ticket.closeDashBoardTicketInfo),$(document).on("keyup",".email",window.digiriskdolibarr.ticket.checkValidEmail),$(document).on("keyup",".options_digiriskdolibarr_ticket_phone",window.digiriskdolibarr.ticket.checkValidPhone)},window.digiriskdolibarr.ticket.updateFormData=function(){var i=window.digiriskdolibarr.ticket.getParentCategory(),e=window.digiriskdolibarr.ticket.getSubCategory();$(".ticket-parentCategory.active").removeClass("active"),$(".ticket-parentCategory"+i).addClass("active"),$(".subCategories").attr("style","display:none"),$(".children"+i).attr("style",""),$(".ticket-subCategory.active").removeClass("active"),$(".ticket-subCategory"+e).addClass("active")},window.digiriskdolibarr.ticket.selectParentCategory=function(){var i=$(".ticketpublicarea").find("#subCategory"),e=$(".ticketpublicarea").find("#parentCategory");i.val(0),e.val($(this).attr("id")),window.digiriskdolibarr.ticket.updateFormData()},window.digiriskdolibarr.ticket.getParentCategory=function(){return $(".ticketpublicarea").find("#parentCategory").val()},window.digiriskdolibarr.ticket.selectSubCategory=function(){$(".ticketpublicarea").find("#subCategory").val($(this).attr("id")),window.digiriskdolibarr.ticket.updateFormData()},window.digiriskdolibarr.ticket.getSubCategory=function(){return $(".ticketpublicarea").find("#subCategory").val()},window.digiriskdolibarr.ticket.tmpStockFile=function(){event.preventDefault();var e=$("#sendfile").prop("files"),s=new FormData;for(let i=0;i<e.length;i++){var t=e[i];s.append("files[]",t)}var a=$("#ticket_id").val();let n=window.saturne.toolbox.getQuerySeparator();window.saturne.loader.display($(".files-uploaded")),fetch(document.URL+n+"action=sendfile&ticket_id="+a,{method:"POST",body:s}).then(i=>{$("#sendFileForm").load(document.URL+n+"ticket_id="+a+" #fileLinkedTable")})},window.digiriskdolibarr.ticket.removeFile=function(i){let e=$(this).attr("value");e=e.replace("_mini","");var s=$("#ticket_id").val(),t=window.saturne.toolbox.getQuerySeparator();fetch(document.URL+t+"action=removefile&filetodelete="+e+"&ticket_id="+s,{method:"POST"}).then(i=>{$(this).parent().parent().hide()})},window.digiriskdolibarr.ticket.addDashBoardTicketInfo=function(){var i=window.saturne.toolbox.getToken(),e=$("#select2-boxcombo-container").attr("title"),s=e.split(" : ")[0],e=e.split(" : ")[2],t=window.saturne.toolbox.getQuerySeparator();$.ajax({url:document.URL+t+"action=adddashboardinfo&token="+i,type:"POST",processData:!1,data:JSON.stringify({digiriskelementID:s,catID:e}),contentType:!1,success:function(i){window.location.reload()},error:function(){}})},window.digiriskdolibarr.ticket.closeDashBoardTicketInfo=function(){var i=window.saturne.toolbox.getToken();let e=$(this);var s=e.attr("data-digiriskelementid"),t=e.attr("data-catid"),a=window.saturne.toolbox.getQuerySeparator();$.ajax({url:document.URL+a+"action=closedashboardinfo&token="+i,type:"POST",processData:!1,data:JSON.stringify({digiriskelementID:s,catID:t}),contentType:!1,success:function(i){e.closest(".box-flex-item").fadeOut(400),$(".add-widget-box").attr("style",""),$(".add-widget-box").html($(i).find(".add-widget-box").children())},error:function(){}})},window.digiriskdolibarr.ticket.checkValidEmail=function(){0==/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(this.value)?$(this).css("border","3px solid red"):$(this).css("border","3px solid green")},window.digiriskdolibarr.ticket.checkValidPhone=function(){0==/^(?:(?:(?:\+|00)\d{2}[\s]?(?:\(0\)[\s]?)?)|0){1}[1-9]{1}([\s.-]?)(?:\d{2}\1?){3}\d{2}$/.test(this.value)?$(this).css("border","3px solid red"):$(this).css("border","3px solid green")},window.digiriskdolibarr.digiriskusers={},window.digiriskdolibarr.digiriskusers.init=function(){window.digiriskdolibarr.digiriskusers.event()},window.digiriskdolibarr.digiriskusers.event=function(){$(document).on("input",".digirisk-users #firstname",window.digiriskdolibarr.digiriskusers.fillEmail),$(document).on("input",".digirisk-users #lastname",window.digiriskdolibarr.digiriskusers.fillEmail)},window.digiriskdolibarr.digiriskusers.fillEmail=function(i){var e=$(".digirisk-users #firstname").val(),s=$(".digirisk-users #lastname").val(),t=$(".input-domain-mail").val(),e=window.digiriskdolibarr.digiriskusers.removeDiacritics(e+"."+s+"@"+t).toLowerCase();$(".digirisk-users #email").val(e)},window.digiriskdolibarr.digiriskusers.removeDiacritics=function(i){for(var e="",s=i.normalize("NFD"),t=0,a=0;t<i.length;)e+=s[a],a+=i[t]==s[a]?1:2,t++;return e};